openapi: 3.1.0
info:
  title: Money Partition Indexing Backend API
  description: |-
    Money partition indexing backend processes blocks from the money
    partition and indexes ownership of the bills. This API provides
    access to the indexed data.
  version: '1.0'
servers:
  - url: /api/v1
  - url: http://localhost:{port}/api/v1
    variables:
      port:
        default: '9654'
paths:
  /round-number:
    get:
      summary: Get the latest round number of the money partition
      description: |-
        Returns the round number of the latest certified round known
        to the partition node which indexing backend is connected
        to. Useful for calculating transaction timeout values.
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: 'components.yaml#/schemas/RoundNumberResponse'
        default:
          $ref: 'components.yaml#/responses/ErrorResponse'
  /balance:
    get:
      summary: Get the balance for a public key
      description: |-
        Returns the sum of all bills owned by the given public key.
      parameters:
        - description: Hex encoded public key prefixed with `0x`
          in: query
          name: pubkey
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BalanceResponse'
        default:
          $ref: 'components.yaml#/responses/ErrorResponse'
  /list-bills:
    get:
      summary: List bills owned by a public key
      description: |-
        Returns all bills owned by the given public key.
      parameters:
        - name: pubkey
          description: Hex encoded public key prefixed with `0x`
          in: query
          required: true
          schema:
            type: string
          example: '0x000000000000000000000000000000000000000000000000000000000000000123'
        - name: limit
          description: Limits how many bills are returned in response
          in: query
          schema:
            type: integer
            default: 100
        - name: offset
          description: Response will include bills starting after offset
          in: query
          schema:
            type: integer
            default: 0
        - name: includedcbills
          description: Response will include DC bills
          in: query
          schema:
            type: bool
            default: false
        - name: includedcmetadata
          description: Response will include DC metadata (includedcbills param must also be true)
          in: query
          schema:
            type: bool
            default: false
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListBillsResponse'
        default:
          $ref: 'components.yaml#/responses/ErrorResponse'
  /tx-history/{pubkey}:
    get:
      summary: Get transaction history for a public key
      parameters:
        - name: pubkey
          description: Hex encoded public key prefixed with `0x`
          in: path
          required: true
          schema:
            $ref: 'components.yaml#/schemas/PublicKeyParam'
        - name: limit
          description: Limits how many transactions are returned in response
          in: query
          schema:
            type: integer
            default: 100
        - name: offset
          description: Response will include transactions starting after offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: Successful operation
          content:
            application/cbor:
              schema:
                type: string
                format: binary
        default:
          $ref: 'components.yaml#/responses/ErrorResponse'
  /units/{unitId}/transactions/{txHash}/proof:
    get:
      summary: Get transaction proof by unit ID and transaction hash
      parameters:
        - name: unitId
          description: Hex encoded unit ID of the bill to get transaction proof for, prefixed with `0x`
          in: path
          required: true
          schema:
            $ref: 'components.yaml#/schemas/UnitIDParam'
        - name: txHash
          description: Hex encoded hash of the transaction to get proof for, prefixed with `0x`
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Transaction proof was found
          content:
            application/cbor:
              schema:
                type: string
                format: binary
        '404':
          description: Transaction is not in the index
          content:
            application/json:
              schema:
                $ref: 'components.yaml#/schemas/ErrorResponse'
        default:
          $ref: 'components.yaml#/responses/ErrorResponse'
  /fee-credit-bills/{billId}:
    get:
      summary: Get a fee credit bill and its latest transaction proof by bill ID
      description: |-
        Returns the fee credit bill together with the latest
        transaction proof for it.
      parameters:
        - name: billId
          description: ID of the bill (hex)
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: 'components.yaml#/schemas/Bill'
        default:
          $ref: 'components.yaml#/responses/ErrorResponse'
  /locked-fee-credit/{systemId}/{billId}:
    get:
      summary: Get the last transferFC transaction for the given partition and fee credit bill
      description: Get the last transferFC transaction for the given partition and fee credit bill
      parameters:
        - name: systemId
          description: Target fee credit system ID of the transferFC transaction (hex)
          in: path
          required: true
          schema:
            type: string
        - name: billId
          description: Target fee credit bill ID (hex)
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful operation
          content:
            application/cbor:
              schema:
                type: string
                format: binary
        default:
          $ref: 'components.yaml#/responses/ErrorResponse'
  /closed-fee-credit/{billId}:
    get:
      summary: Get the last seen closeFC transaction for the given fee credit bill
      description: Get the last seen closeFC transaction for the given fee credit bill
      parameters:
        - name: billId
          description: Target fee credit bill ID (hex)
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful operation
          content:
            application/cbor:
              schema:
                type: string
                format: binary
        default:
          $ref: 'components.yaml#/responses/ErrorResponse'
  /transactions/{pubkey}:
    post:
      summary: Forward transactions to partition node
      description: |-
        Allows to send raw CBOR encoded transactions to partition
        node. Request body must be a CBOR encoded array of raw
        transactions. The documentation for raw transaction format can
        be found on Alphabill Documentation portal.
      parameters:
        - name: pubkey
          description: Hex encoded sender public key prefixed with `0x`
          in: path
          required: true
          schema:
            $ref: 'components.yaml#/schemas/PublicKeyParam'
      requestBody:
        description: CBOR encoded array of TransactionOrders
        required: true
        content:
          application/cbor: {}
      responses:
        '202':
          description: Successful operation
        '500':
          $ref: 'components.yaml#/responses/PostTransactionsErrorResponse'
        default:
          $ref: 'components.yaml#/responses/ErrorResponse'
components:
  schemas:
    BalanceResponse:
      type: object
      properties:
        balance:
          type: string
          example: '500'
    ListBillsResponse:
      type: object
      properties:
        bills:
          type: array
          items:
            $ref: 'components.yaml#/schemas/Bill'
        dcMetadata:
          type: object
          properties:
            billIdentifiers:
              type: array
              items:
                type: string
                example: 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE='
            dcSum:
              type: string
              example: '15'
        total:
          type: integer
          description: Total number of bills in the response
          example: 5
